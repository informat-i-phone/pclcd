<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Factures/Devis</title>
    <style>
        /* Style inchangé */
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.21/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script>
        window.onload = function() {
            emailjs.init("38gyd-UrPG6stjh1C"); // Remplacez par votre User ID EmailJS
        };

        async function genererPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Code pour générer le PDF inchangé

            const nomFichier = nomClient && prenomClient ? `${nomClient}_${prenomClient}_${typeDocument}.pdf` : `${numeroFacture}_${typeDocument}.pdf`;

            // Générer le PDF en base64
            const pdfBlob = doc.output('datauristring');

            // Envoi par email via EmailJS
            const emailParams = {
                to_email: document.getElementById('emailTo').value,
                from_name: "GSM PC MAC",
                message_html: `Veuillez trouver en pièce jointe votre ${typeDocument}.`,
                'attachment': pdfBlob
            };

            emailjs.send('service_8ri1lhm', 'template_ef2dub3', emailParams)
            .then((response) => {
                alert("Email envoyé avec succès !");
            }, (error) => {
                alert("Erreur lors de l'envoi de l'email : " + error.text);
            });

            // Téléchargement local (optionnel)
            doc.save(nomFichier);
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Générateur de Factures/Devis</h1>
        <h2>Informations du Client</h2>
        <!-- Formulaire inchangé -->
        <button onclick="genererPDF()">Générer et Envoyer PDF</button>
        <div class="result" id="result"></div>
    </div>
</body>
</html>
